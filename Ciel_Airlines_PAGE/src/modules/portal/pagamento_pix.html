<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pagamento - pix</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link rel="stylesheet" href="pagamentos.css">
    <link rel="icon" href="../../assets/img/logo.png">
</head>
<body>
  <!--navBar-->
    <div class="card text-center" id="nav">
        <div class="card-header" id="nav">
          <a class="navbar-brand" href="#">
            <img src="../../../src/assets/img/logo_nome.png" alt="Logo" width="200" height="70" alt="logo" draggable="false" >
          </a>
          <ul class="nav nav-tabs card-header-tabs">
            <li class="nav-item">
              <a class="nav-link active custom-nav-link" aria-current="true" href="#">Passagens</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="portalbusca.html">Home</a>
            </li>
            </li>
          </ul>
        </div>
        <div class="card-body" id="nav">
          <div class="background-img">
            <h5 class="card-title" id="nav">PASSAGENS</h5>
            <p class="card-text" id="nav">Pagamento</p>
          </div>
        </div>
      </div>
        <!--Area pix-->
            <div class="container">
                <h2>Pagamento</h2>
                        <img id="pix" src="../../assets/img/pix.jpg">
                        <label for="Codigo" style="text-align: center;">hdsfhga-sfhjsagfhgahsgfd-g743657249999jj777778ggghg</label>
                        <button onclick="confirmar()">Confirmar</button>
                        <p id="status" class="statusError"></p>
                        <button onclick="voltar()">Voltar</button>
            </div>
    <footer>
      <div class="footer-content">
          <div class="imgFooter">
              <img src="../../assets/img/logo_nome.png">
          </div>
          <div class="footer-left">
              <h3>Contato</h3>
              <ul>
                <a href="#"><img src="../../assets/img/icon_facebook.png"></a>
                <a href="#"><img src="../../assets/img/icon_instagram.png"></a>
                <a href="#"><img src="../../assets/img/icon_linkedin.png"></a>
              </ul>
          </div>
          <p>&copy; 2023.CielArlines</p>
      </div>
  </footer>
    <script>
      function MessageStatus(msg, error){
        var pStatus = document.getElementById("status");

        if(error === true){
            pStatus.className = " statusError";
        }
        else{
            pStatus.className = 'statusSuccess';
        }
        pStatus.textContent = msg;
      }

        // Obter os dados armazenados em sessionStorage
        //'sessionStorege' armazena dados de forma simples e sem expiração, ou seja, ficam lá enquanto a guia estiver aberta (sessao)
        const nome = sessionStorage.getItem('nomeConfirmado');
        const email = sessionStorage.getItem('emailConfirmado');
        const idMetodo = sessionStorage.getItem('metodoPagamento');
        const idAssento = sessionStorage.getItem('idAssento');
        const idVoo = obterParametroUrl('idVoo');
        
      function fetchInserir(body) {
        console.log("cheguei no fetch")
        const requestOptions = {
              method: 'PUT', headers: { 'Content-Type': "application/json" }, body: JSON.stringify(body)
          };
          return fetch('http://localhost:3000/insertVenda', requestOptions).then(T => T.json())
      }

      function inserirVenda() {
        fetchInserir({
          nome: nome,
          email:email,
          idAssento: idAssento,
          idVoo: idVoo,
          idMetodo:idMetodo
        })
            .then(customResponse => {
                if (customResponse.status === "SUCCESS") {
                    MessageStatus("Venda cadastrada... ", false);
                } else {
                    MessageStatus("Erro ao cadastrar Venda...: " + customResponse.message, true);
                    console.log(customResponse.message);
                }
            })
            .catch((e) => {
                MessageStatus("Erro técnico ao cadastrar... Contate o suporte.", true);
                console.log("Falha grave ao cadastrar." + e)
            });
    }

      
      //função para o botão, abre uma pagina html
      function voltar(){
        window.location.href = `dados.html?idVoo=${idVoo}`;
      }
      //função para o botão, abre uma pagina html
      function confirmar(){
        inserirVenda();
        window.location.href = 'aprovado.html';
      }

      function obterParametroUrl(nome) {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get(nome);
      }

    </script>
</body>
</html>
