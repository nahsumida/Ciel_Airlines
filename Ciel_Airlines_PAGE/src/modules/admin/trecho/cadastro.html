<!DOCTYPE html>
<html lang="pt-br">
    <head>
        <link rel="stylesheet" href="../../../assets/css/areas.css">
        <link rel="icon" href="../../../assets/img/favicon-96x96.png">

        <title>Trecho - Cadastro</title>

        <script>
            function MessageStatus(msg, error){
                var pStatus = document.getElementById("status");

                if(error === true){
                    pStatus.className = " statusError";
                }
                else{
                    pStatus.className = 'statusSucess'
                }
                pStatus.textContent = msg;
            }
            function fetchListar(body){
                const requestOptions = {
                    method: 'GET', headers: {'Content-Type' : "application/json"}, body: JSON.stringify(body)
                };

                return fetch('http://localhost:3000/listarAeroporto', requestOptions).then(T => T.json())
            }

            function fetchInserir(body){
                const requestOptions = {
                    method: 'POST', headers: {'Content-Type' : "application/json"}, body: JSON.stringify(body)
                };

                return fetch('http://localhost:3000/incluirTrecho', requestOptions).then(T => T.json())
            }

            function inserirTrecho(saida, chegada){
                fetchInserir({
                    aeroSaida : chegada,
                    aeroChegada : saida
	            })
                    .then(customResponse => {
                    if(customResponse.status === "SUCCESS"){
                        MessageStatus("Trecho cadastrado... ", false);
                    }else{
                        MessageStatus("Erro ao cadastrar TRECHO...: " + customResponse.message, true);
                        console.log(customResponse.message);
                    }
                    })
                    .catch((e)=>{
                        MessageStatus("Erro técnico ao cadastrar... Contate o suporte.", true);
                        console.log("Falha grave ao cadastrar." + e)
                    });
            }

            function listarAeroportoSaida(){
                const aeroSaida = document.getElementById('aeroSaida');

                fetchListar()
                    .then(customResponse => {
                    if(customResponse.status === "SUCCESS"){
                        aeroSaida.innerHTML = '';

                        customResponse.payload.forEach(item => {
                            const idAeroporto = item[0];
                            const nomeAeroporto = item[2];

                            const option = document.createElement('option');
                            option.value = idAeroporto; // Valor da opção
                            option.text = `${nomeAeroporto}`; // Texto visível

                            aeroSaida.appendChild(option);
                        });
                    }else{
                        MessageStatus("Erro ao listar Trecho...: " + customResponse.message, true);
                        console.log(customResponse.message);
                    }
                    })
                    .catch((e)=>{
                        MessageStatus("Erro técnico ao listar... Contate o suporte.", true);
                        console.log("Falha grave ao listar." + e)
                    });
            }

            function listarAeroportoChegada(){
                const aeroChegada = document.getElementById('aeroChegada');

                fetchListar()
                    .then(customResponse => {
                    if(customResponse.status === "SUCCESS"){
                        aeroChegada.innerHTML = '';

                        customResponse.payload.forEach(item => {
                            const idAeroporto1 = item[0];
                            const nomeAeroporto = item[2];

                            const option = document.createElement('option');
                            option.value = idAeroporto1; // Valor da opção
                            option.text = `${nomeAeroporto}`; // Texto visível

                            aeroChegada.appendChild(option);
                        });
                    }else{
                        MessageStatus("Erro ao listar Trecho...: " + customResponse.message, true);
                        console.log(customResponse.message);
                    }
                    })
                    .catch((e)=>{
                        MessageStatus("Erro técnico ao listar... Contate o suporte.", true);
                        console.log("Falha grave ao listar." + e)
                    });
            }

                        
            document.addEventListener("DOMContentLoaded", function() {
                listarAeroportoSaida();
                listarAeroportoChegada();

                const button = document.getElementById("btnCadastrar");
                var selectSaida = document.getElementById("aeroSaida");
                var selectChegada = document.getElementById("aeroChegada");

                if (button) {
                    button.addEventListener('click', function() {
                        var selectedIndex = selectSaida.selectedIndex; // Índice da opção selecionada
                        var selectedOption = selectSaida.options[selectedIndex]; // Opção selecionada
                        var selectedSaida = selectedOption.value; 

                        var selectedIndex1 = selectChegada.selectedIndex; // Índice da opção selecionada
                        var selectedOption1 = selectChegada.options[selectedIndex1]; // Opção selecionada
                        var selectedChegada = selectedOption1.value;

                        console.log("aa" , selectedSaida)
                        console.log("bb" , selectedChegada)

                        inserirTrecho(selectedSaida, selectedChegada);
                    });
                }
            });

        </script>
    </head>
    <body>
        <main>
            <h1>Cadastrar - TRECHO</h1>
            <form>
                <p>
                    <label for="AeroSaida">Aeroporto de Partida:</label><br/>
                    <select id="aeroSaida" name="aeroSaida"></select>
                </p>
                <p>
                    <label for="AeroChegada">Aeroporto de Destino:</label><br/>
                    <select id="aeroChegada" name="aeroChegada"></select>
                </p>
                <p>
                    <button type="button" onclick="inserirTrecho();" id="btnCadastrar" name="btnCadastrar">Cadastrar</button>
                    <a href="../admin.html"><button type="button" src id="btnSair" name="btnSair">Sair</button></a>
                </p>
                <p id="status" class="statusError"></p>
            </form>
        </main>
    </body>
</html>
