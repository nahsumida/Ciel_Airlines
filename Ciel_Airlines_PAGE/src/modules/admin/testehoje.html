<!DOCTYPE html>
<html lang="pt-br">
    <head>
        <!--<link rel="icon" href="../../../assets/img/favicon-96x96.png">-->
        <link rel="stylesheet" href="testehoje.css">

        <title>COMPANHIA - LISTAGEM</title>
    </head>
    <body>
        <main>
            <h1>Listar Mapa de Assentos</h1>
            <table id="dataTable">
                <thead>
                    <tr>
                        <th id="aStyle">A</th>
                        <th id="bStyle">B</th>
                    </tr>
                </thead>
                <tbody id="dataBody"></tbody>
            </table>
            <p id="status" class="statusError"></p>
        </main>
    </body>
    <script>
        function MessageStatus(msg, error){
            var pStatus = document.getElementById("status");

            if(error === true){
                pStatus.className = " statusError";
            }
            else{
                pStatus.className = 'statusSuccess'
            }
            pStatus.textContent = msg;
        }

        function fetchListarAssento(body){
            console.log("cheguei no aqui")
            const requestOptions = {
                method: 'POST', headers: {'Content-Type' : "application/json"}, body: JSON.stringify(body)
            };

            return fetch('http://localhost:3000/selectAssentoByVoo', requestOptions).then(T => T.json())
        }

// Função para listar assentos de um voo específico
function ListarAssentos(idVoo) {
    const dataBody = document.getElementById('dataBody');

    // Chama a função de requisição para listar os assentos do voo com o ID fornecido
    fetchListarAssento({
        idVoo: idVoo
    })
        .then(customResponse => {
            if (customResponse.status === "SUCCESS") {
                // Limpa qualquer conteúdo anterior da tabela
                dataBody.innerHTML = '';

                let esse = customResponse.payload;
                console.log(esse);
                let tam = esse.length;
                console.log(tam);

                let estilobtn = "assentoLivre";

                // Loop para preencher a tabela com os assentos em pares
                for (let i = 0; i < tam - 1; i += 2) {
                    let item = customResponse.payload[i];
                    let item2 = customResponse.payload[i + 1];

                    const idassento1 = item[0];
                    const codigo1 = item[2];
                    const status1 = item[3];

                    const idassento2 = item2[0];
                    const codigo2 = item2[2];
                    const status2 = item2[3];

                    // Criação de botões para os assentos, funcao js
                    const button1 = document.createElement('button');
                    button1.textContent = codigo1;
                    button1.setAttribute('idAssento', idassento1);

                    //definir estilo css para o botao, atribuindo a classe
                    if (status1 === "DISPONIVEL"){
                        estilobtn = "assentoLivre";
                    } else {
                        estilobtn = "assentoOcupado";
                    }
                    button1.className = estilobtn;


                    button1.addEventListener('click', function() {
                        // Lógica para lidar com o clique do botão
                        console.log(`Assento selecionado com ID: ${idassento1} ${status1}`);
                    });

                    const button2 = document.createElement('button');
                    button2.textContent = codigo2;
                    button2.setAttribute('idAssento', idassento2);
                    button2.addEventListener('click', function() {
                        // Lógica para lidar com o clique do botão
                        console.log(`Assento selecionado com ID: ${idassento2} ${status2}`);
                    });

                    //definir estilo css para o botao, atribuindo a classe
                    if (status2 === "DISPONIVEL"){
                        estilobtn = "assentoLivre";
                    } else {
                        estilobtn = "assentoOcupado";
                    }
                    button2.className = estilobtn;
                    
                    // Adiciona os botões ao corpo da tabe;a
                    dataBody.appendChild(button1);
                    // Adiciona um espaço entre os botões
                    dataBody.appendChild(button2);
                    dataBody.appendChild(document.createElement('br')); // Adiciona uma quebra de linha entre os pares de botões
                }
            } else {
                MessageStatus("Erro ao listar assentos: " + customResponse.message, true);
                console.log(customResponse.message);
            }
        })
        .catch((e) => {
            MessageStatus("Erro técnico ao listar assentos. Contate o suporte.", true);
            console.log("Falha grave ao listar assentos." + e);
        });
}


// funcao para pegar o parametro idVoo passado na url
function obterParametroUrl(nome) {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get(nome);
}



// CHAMADA DAS FUNCOES no carregamento da página
document.addEventListener("DOMContentLoaded", function() {


    // Obtém o ID do voo da URL
    const idVoo = obterParametroUrl('idVoo');

    // Verifica se o ID do voo foi obtido com sucesso
    if (idVoo !== null) {
        console.log('ID do Voo:', idVoo);
        // Faça aqui o que for necessário com o ID do voo
        ListarAssentos(idVoo);
    } else {
        console.error('ID do Voo não encontrado na URL.');
    }
    
    
});


    </script>
</html>